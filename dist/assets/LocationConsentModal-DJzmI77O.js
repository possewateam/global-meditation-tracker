import{u as E,r as i,j as e,N as f,aa as I,G as w,f as v,a9 as A,c as M}from"./vendor-react-CsWuKxj5.js";import{s as y}from"./page-admin-DgYsNXAM.js";import{f as k,g as P,r as q,a as L}from"./location-C0cwv-Fe.js";import"./vendor-other-D2N4SXMU.js";import"./vendor-three-WWH58ZbN.js";import"./vendor-i18n-CPrbmvBl.js";import"./vendor-supabase-D4rA0elu.js";const Y=({isOpen:S,userId:h,userProfile:b,onComplete:n,onSkip:c})=>{const{t}=E(),[l,r]=i.useState("initial"),[s,d]=i.useState(null),[m,p]=i.useState(null),[g,x]=i.useState(!1);if(!S)return null;const _=async()=>{r("requesting"),x(!0),p(null);try{const a=await q();d(a),r("success"),await u(a,"granted"),setTimeout(()=>{n(a)},1500)}catch(a){const o=a;p(o);const N=L(b);d(N),r("fallback");const D=o.code==="PERMISSION_DENIED"?"denied":"prompt";await u(N,D),x(!1)}},j=async()=>{x(!0);const a=L(b);d(a),await u(a,"denied"),setTimeout(()=>{n(a)},1e3)},C=async()=>{c&&(await y.from("users").update({location_consent_given:!0,location_permission_status:"denied",location_consent_date:new Date().toISOString()}).eq("id",h),c())},u=async(a,o)=>{await y.from("users").update({latitude:a.latitude,longitude:a.longitude,location_source:a.source,location_accuracy:a.accuracy,location_updated_at:new Date().toISOString(),location_consent_given:!0,location_permission_status:o,location_consent_date:new Date().toISOString()}).eq("id",h)};return e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center p-4 z-[100] animate-fadeIn",children:e.jsxs("div",{className:"bg-gradient-to-br from-teal-900/95 to-blue-900/95 backdrop-blur-xl rounded-3xl max-w-lg w-full shadow-2xl border border-teal-500/30 overflow-hidden",children:[l==="initial"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsxs("div",{className:"mb-6 relative inline-block",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-400 to-teal-400 rounded-full blur-xl opacity-50 animate-pulse"}),e.jsx("div",{className:"relative bg-gradient-to-br from-green-500 to-teal-600 p-6 rounded-full",children:e.jsx(f,{className:"w-12 h-12 text-white"})})]}),e.jsx("h2",{className:"text-3xl font-bold text-white mb-3",children:t("location.enableTitle","Enable Location")}),e.jsx("p",{className:"text-teal-200 text-lg mb-6 leading-relaxed",children:t("location.enableDescription","Share your location to appear on our live global meditation map and connect with meditators worldwide.")}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-6 space-y-4 text-left border border-white/20",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(I,{className:"w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-semibold mb-1",children:t("location.highAccuracy","High Accuracy GPS")}),e.jsx("p",{className:"text-teal-300 text-sm",children:t("location.highAccuracyDesc","Get precise location for accurate map display")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(w,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-semibold mb-1",children:t("location.globalMap","Global Connection")}),e.jsx("p",{className:"text-teal-300 text-sm",children:t("location.globalMapDesc","See and be seen by meditators around the world")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(v,{className:"w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-semibold mb-1",children:t("location.privacy","Your Privacy Matters")}),e.jsx("p",{className:"text-teal-300 text-sm",children:t("location.privacyDesc","Location is only used for the meditation map. You can change this later.")})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:_,className:"w-full py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-bold text-lg hover:shadow-lg hover:shadow-green-500/50 transition-all duration-300 transform hover:scale-[1.02] flex items-center justify-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),t("location.allowButton","Allow Location Access")]}),e.jsx("button",{onClick:j,disabled:g,className:"w-full py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-semibold transition-all duration-300 border border-white/20",children:t("location.useCityButton","Use My City Instead")}),c&&e.jsx("button",{onClick:C,className:"w-full py-2 text-teal-300 hover:text-teal-200 text-sm transition-colors",children:t("location.skipButton","Skip for now")})]})]})}),l==="requesting"&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative inline-block",children:[e.jsx(A,{className:"w-16 h-16 text-teal-400 animate-spin"}),e.jsx("div",{className:"absolute inset-0 bg-teal-400/20 rounded-full blur-xl animate-pulse"})]})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:t("location.requesting","Requesting Location...")}),e.jsx("p",{className:"text-teal-300",children:t("location.requestingDesc","Please allow location access in your browser when prompted.")})]}),l==="success"&&s&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"absolute inset-0 bg-green-400 rounded-full blur-xl opacity-50"}),e.jsx("div",{className:"relative bg-gradient-to-br from-green-500 to-emerald-600 p-6 rounded-full",children:e.jsx(M,{className:"w-12 h-12 text-white"})})]})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:t("location.success","Location Detected!")}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 mb-4 border border-white/20",children:[e.jsx("p",{className:"text-teal-200 mb-2",children:k(s)}),e.jsxs("p",{className:"text-teal-400 text-sm",children:[t("location.accuracy","Accuracy"),": ",P(s.accuracy)]}),s.accuracy&&e.jsxs("p",{className:"text-teal-500 text-xs mt-1",children:["Â±",Math.round(s.accuracy),"m"]})]}),e.jsx("p",{className:"text-green-400 font-semibold",children:t("location.redirecting","Redirecting to meditation...")})]}),l==="fallback"&&s&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-400 rounded-full blur-xl opacity-50"}),e.jsx("div",{className:"relative bg-gradient-to-br from-blue-500 to-cyan-600 p-6 rounded-full",children:e.jsx(w,{className:"w-12 h-12 text-white"})})]})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:t("location.usingCity","Using Your City Location")}),m&&e.jsx("div",{className:"bg-orange-500/20 backdrop-blur-sm rounded-xl p-4 mb-4 border border-orange-500/30",children:e.jsx("p",{className:"text-orange-200 text-sm",children:m.code==="PERMISSION_DENIED"?t("location.permissionDenied","Location permission was denied"):t("location.unavailable","GPS location unavailable")})}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 mb-6 border border-white/20",children:[e.jsx("p",{className:"text-teal-200 mb-2",children:k(s)}),e.jsx("p",{className:"text-teal-400 text-sm",children:t("location.approximateLocation","Approximate location from your profile")})]}),e.jsx("button",{onClick:()=>n(s),disabled:g,className:"w-full py-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-xl font-bold text-lg hover:shadow-lg hover:shadow-blue-500/50 transition-all duration-300",children:t("location.continueButton","Continue to Meditation")})]}),l==="error"&&!s&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"mb-6",children:e.jsx(v,{className:"w-16 h-16 text-red-400 mx-auto"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:t("location.error","Location Error")}),e.jsx("p",{className:"text-red-300 mb-6",children:m?.message||t("location.errorDesc","Could not determine your location")}),e.jsx("button",{onClick:j,className:"w-full py-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-xl font-bold text-lg hover:shadow-lg hover:shadow-blue-500/50 transition-all duration-300",children:t("location.useCityButton","Use My City Instead")})]})]})})};export{Y as LocationConsentModal};
