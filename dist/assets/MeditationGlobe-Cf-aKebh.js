const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/page-admin-cU6anLI0.js","assets/vendor-react-B3cVin9Q.js","assets/vendor-other-D9QTidg2.js","assets/vendor-three-DgmlkwHn.js","assets/vendor-i18n-DgyYewF3.js","assets/vendor-react-Bbgo5x5y.css","assets/vendor-supabase-BYHeWUli.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,__name=(t,n)=>e(t,"name",{value:n,configurable:!0});import{a as t,_ as n}from"./index-BxZ87--W.js";import{r as a,j as o,X as r,af as s,ag as i}from"./vendor-react-B3cVin9Q.js";import{s as l}from"./page-admin-cU6anLI0.js";import"./vendor-i18n-DgyYewF3.js";import"./vendor-three-DgmlkwHn.js";import"./vendor-other-D9QTidg2.js";import"./vendor-supabase-BYHeWUli.js";const d=__name((e,t,n=new Date)=>{const a=new Date(e),o=t?new Date(t):n,r=new Date(n);r.setHours(0,0,0,0);const s=new Date(r);s.setHours(23,59,59,999);const i=Math.max(a.getTime(),r.getTime()),l=Math.min(o.getTime(),s.getTime()),d=Math.max(0,l-i);return Math.floor(d/1e3)},"calculateTodayDuration"),c=__name(()=>{const{items:e,loading:c,error:m}=t(),u=a.useRef(),p=a.useRef(null),[h,g]=a.useState({width:600,height:600}),[f,b]=a.useState({}),[v,y]=a.useState(2.5),[w,x]=a.useState(!1),[E,j]=a.useState(!1),[_,M]=a.useState("night");a.useEffect(()=>{const e=__name(()=>{if(w)g({width:window.innerWidth,height:window.innerHeight});else{const e=Math.min(window.innerWidth-40,800),t=Math.min(.5*window.innerHeight,600);g({width:e,height:t})}},"updateSize");return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[w]),a.useEffect(()=>{const e=__name(()=>{x(!!document.fullscreenElement)},"handleFullscreenChange");return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]);const D=__name(async()=>{if(p.current)try{document.fullscreenElement?await document.exitFullscreen():await p.current.requestFullscreen()}catch(e){}},"toggleFullscreen");a.useEffect(()=>{if(u.current){const e=u.current.controls();e.autoRotate=!1,e.enableZoom=E,e.enableRotate=E,e.enablePan=E,e.addEventListener("change",()=>{const e=u.current.camera();if(e&&e.position){const t=e.position.length();y(t)}}),u.current.pointOfView({lat:20,lng:78,altitude:2.5},1e3)}},[E]),a.useEffect(()=>{const e=__name(async()=>{const{supabase:e}=await n(async()=>{const{supabase:e}=await import("./page-admin-cU6anLI0.js").then(e=>e.a);return{supabase:e}},__vite__mapDeps([0,1,2,3,4,5,6])),{data:t}=await e.from("meditation_sessions").select("id, name, start_time, end_time, is_active");if(t){const e={},n=new Map;t.forEach(e=>{n.set(e.id,e)});const a=new Date;n.forEach(t=>{const n=t.name||"Anonymous",o=d(t.start_time,t.end_time,a);e[n]=(e[n]||0)+o}),b(e)}},"fetchTodayStats");e();const t=setInterval(e,3e4);return()=>clearInterval(t)},[e]),a.useEffect(()=>{__name(async()=>{const{data:e}=await l.from("settings").select("value").eq("key","globe_day_night_mode").maybeSingle();e&&M(e.value)},"fetchGlobeMode")();const e=l.channel("globe-mode-updates").on("postgres_changes",{event:"*",schema:"public",table:"settings",filter:"key=eq.globe_day_night_mode"},e=>{e.new&&"object"==typeof e.new&&"value"in e.new&&M(e.new.value)}).subscribe();return()=>{l.removeChannel(e)}},[]);const L=e.map(e=>({lat:e.lat,lng:e.lon,name:e.name,location:[e.city,e.country].filter(Boolean).join(", ")||"Unknown",startTime:e.started_at,todayDuration:f[e.name]||0}));return c?o.jsx("div",{className:"flex items-center justify-center",style:{height:h.height},children:o.jsx("div",{className:"text-teal-300 animate-pulse",children:"Loading globe..."})}):m?o.jsx("div",{className:"flex items-center justify-center",style:{height:h.height},children:o.jsxs("div",{className:"text-red-400",children:["Error loading meditators: ",m]})}):o.jsxs("div",{ref:p,className:"relative flex justify-center items-center transition-all duration-300 "+(w?"bg-gradient-to-br from-blue-900 via-teal-800 to-emerald-900":""),onMouseEnter:__name(()=>j(!0),"onMouseEnter"),onMouseLeave:__name(()=>j(!1),"onMouseLeave"),onWheel:__name(e=>{E&&e.stopPropagation()},"onWheel"),style:{cursor:E?"grab":"default",pointerEvents:E?"auto":"none"},children:[o.jsx("button",{onClick:D,className:"absolute top-4 left-4 z-20 bg-white/20 hover:bg-white/40 backdrop-blur-md rounded-full p-3 transition-all duration-300 group",title:w?"Exit Fullscreen":"Enter Fullscreen",style:{pointerEvents:"auto"},children:o.jsx(w?r:s,{className:"w-5 h-5 text-white group-hover:scale-110 transition-transform"})}),o.jsx(i,{ref:u,width:h.width,height:h.height,backgroundColor:"day"===_?"rgba(160, 216, 239, 0.3)":"rgba(0, 0, 32, 0.3)",globeImageUrl:"day"===_?"https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg":"https://unpkg.com/three-globe/example/img/earth-night.jpg",bumpImageUrl:"https://unpkg.com/three-globe/example/img/earth-topology.png",htmlElementsData:L,htmlElement:__name(e=>{const t=document.createElement("div"),n=`${Math.floor(e.todayDuration/60)}m ${e.todayDuration%60}s`,a=Math.min(v/2.5,1.5);return t.innerHTML=`\n            <div style="\n              position: relative;\n              width: 32px;\n              height: 32px;\n              cursor: pointer;\n              transform-origin: center center;\n              transform: scale(${1/a});\n            ">\n              <div style="\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 50px;\n                height: 50px;\n                animation: golden-ripple 2.5s ease-out infinite;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                border-radius: 50%;\n              ">\n                <img\n                  src="/yogi1.png"\n                  alt="Meditator"\n                  style="\n                    width: 36px;\n                    height: 36px;\n                    object-fit: contain;\n                    filter: drop-shadow(0 0 12px rgba(251, 191, 36, 1))\n                           drop-shadow(0 0 8px rgba(251, 191, 36, 0.8))\n                           drop-shadow(0 0 20px rgba(251, 191, 36, 0.6))\n                           drop-shadow(0 0 30px rgba(251, 191, 36, 0.4));\n                  "\n                />\n              </div>\n              <div style="\n                position: absolute;\n                top: -65px;\n                left: 50%;\n                transform: translateX(-50%) scale(${a});\n                background: linear-gradient(135deg, rgba(251, 191, 36, 0.95), rgba(245, 158, 11, 0.95));\n                padding: 8px 12px;\n                border-radius: 8px;\n                white-space: nowrap;\n                font-size: 12px;\n                color: white;\n                pointer-events: none;\n                opacity: 0;\n                transition: opacity 0.3s, transform 0.3s;\n                z-index: 1000;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n                border: 1px solid rgba(251, 191, 36, 0.5);\n              " class="meditator-tooltip">\n                <div style="font-weight: bold; margin-bottom: 4px;">${e.name||"Anonymous"}</div>\n                <div style="font-size: 11px; opacity: 0.9; margin-bottom: 4px;">${e.location}</div>\n                <div style="font-size: 10px; background: rgba(0, 0, 0, 0.3); padding: 3px 6px; border-radius: 4px; text-align: center;">\n                  Today: <span style="font-weight: bold;">${n}</span>\n                </div>\n              </div>\n            </div>\n          `,t.addEventListener("mouseenter",()=>{const e=t.querySelector(".meditator-tooltip");e&&(e.style.opacity="1",e.style.transform="translateX(-50%) translateY(-5px)")}),t.addEventListener("mouseleave",()=>{const e=t.querySelector(".meditator-tooltip");e&&(e.style.opacity="0",e.style.transform="translateX(-50%) translateY(0)")}),t},"htmlElement"),atmosphereColor:"#a855f7",atmosphereAltitude:.15,animateIn:!0})]})},"MeditationGlobe");export{c as MeditationGlobe};
