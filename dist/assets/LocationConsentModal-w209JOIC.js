var e=Object.defineProperty,__name=(t,a)=>e(t,"name",{value:a,configurable:!0});import{u as t,r as a,j as s,N as l,ab as o,G as i,f as n,aa as r,c}from"./vendor-react-B3cVin9Q.js";import{s as d}from"./page-admin-cU6anLI0.js";import{r as m,g as x,f as u,a as h}from"./location-dcz9V2s_.js";import"./vendor-other-D9QTidg2.js";import"./vendor-three-DgmlkwHn.js";import"./vendor-i18n-DgyYewF3.js";import"./vendor-supabase-BYHeWUli.js";const b=__name(({isOpen:e,userId:b,userProfile:p,onComplete:j,onSkip:g})=>{const{t:w}=t(),[N,f]=a.useState("initial"),[v,y]=a.useState(null),[k,S]=a.useState(null),[_,C]=a.useState(!1);if(!e)return null;const D=__name(async()=>{f("requesting"),C(!0),S(null);try{const e=await m();y(e),f("success"),await M(e,"granted"),setTimeout(()=>{j(e)},1500)}catch(e){const t=e;S(t);const a=x(p);y(a),f("fallback");const s="PERMISSION_DENIED"===t.code?"denied":"prompt";await M(a,s),C(!1)}},"handleAllowLocation"),I=__name(async()=>{C(!0);const e=x(p);y(e),await M(e,"denied"),setTimeout(()=>{j(e)},1e3)},"handleUseFallback"),L=__name(async()=>{g&&(await d.from("users").update({location_consent_given:!0,location_permission_status:"denied",location_consent_date:(new Date).toISOString()}).eq("id",b),g())},"handleSkip"),M=__name(async(e,t)=>{await d.from("users").update({latitude:e.latitude,longitude:e.longitude,location_source:e.source,location_accuracy:e.accuracy,location_updated_at:(new Date).toISOString(),location_consent_given:!0,location_permission_status:t,location_consent_date:(new Date).toISOString()}).eq("id",b)},"updateUserLocation");return s.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md flex items-center justify-center p-4 z-[100] animate-fadeIn",children:s.jsxs("div",{className:"bg-gradient-to-br from-teal-900/95 to-blue-900/95 backdrop-blur-xl rounded-3xl max-w-lg w-full shadow-2xl border border-teal-500/30 overflow-hidden",children:["initial"===N&&s.jsx(s.Fragment,{children:s.jsxs("div",{className:"p-8 text-center",children:[s.jsxs("div",{className:"mb-6 relative inline-block",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-green-400 to-teal-400 rounded-full blur-xl opacity-50 animate-pulse"}),s.jsx("div",{className:"relative bg-gradient-to-br from-green-500 to-teal-600 p-6 rounded-full",children:s.jsx(l,{className:"w-12 h-12 text-white"})})]}),s.jsx("h2",{className:"text-3xl font-bold text-white mb-3",children:w("location.enableTitle","Enable Location")}),s.jsx("p",{className:"text-teal-200 text-lg mb-6 leading-relaxed",children:w("location.enableDescription","Share your location to appear on our live global meditation map and connect with meditators worldwide.")}),s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-6 space-y-4 text-left border border-white/20",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(o,{className:"w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-semibold mb-1",children:w("location.highAccuracy","High Accuracy GPS")}),s.jsx("p",{className:"text-teal-300 text-sm",children:w("location.highAccuracyDesc","Get precise location for accurate map display")})]})]}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(i,{className:"w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-semibold mb-1",children:w("location.globalMap","Global Connection")}),s.jsx("p",{className:"text-teal-300 text-sm",children:w("location.globalMapDesc","See and be seen by meditators around the world")})]})]}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(n,{className:"w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-semibold mb-1",children:w("location.privacy","Your Privacy Matters")}),s.jsx("p",{className:"text-teal-300 text-sm",children:w("location.privacyDesc","Location is only used for the meditation map. You can change this later.")})]})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("button",{onClick:D,className:"w-full py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-bold text-lg hover:shadow-lg hover:shadow-green-500/50 transition-all duration-300 transform hover:scale-[1.02] flex items-center justify-center gap-2",children:[s.jsx(l,{className:"w-5 h-5"}),w("location.allowButton","Allow Location Access")]}),s.jsx("button",{onClick:I,disabled:_,className:"w-full py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-semibold transition-all duration-300 border border-white/20",children:w("location.useCityButton","Use My City Instead")}),g&&s.jsx("button",{onClick:L,className:"w-full py-2 text-teal-300 hover:text-teal-200 text-sm transition-colors",children:w("location.skipButton","Skip for now")})]})]})}),"requesting"===N&&s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"mb-6",children:s.jsxs("div",{className:"relative inline-block",children:[s.jsx(r,{className:"w-16 h-16 text-teal-400 animate-spin"}),s.jsx("div",{className:"absolute inset-0 bg-teal-400/20 rounded-full blur-xl animate-pulse"})]})}),s.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:w("location.requesting","Requesting Location...")}),s.jsx("p",{className:"text-teal-300",children:w("location.requestingDesc","Please allow location access in your browser when prompted.")})]}),"success"===N&&v&&s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"mb-6",children:s.jsxs("div",{className:"relative inline-block",children:[s.jsx("div",{className:"absolute inset-0 bg-green-400 rounded-full blur-xl opacity-50"}),s.jsx("div",{className:"relative bg-gradient-to-br from-green-500 to-emerald-600 p-6 rounded-full",children:s.jsx(c,{className:"w-12 h-12 text-white"})})]})}),s.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:w("location.success","Location Detected!")}),s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 mb-4 border border-white/20",children:[s.jsx("p",{className:"text-teal-200 mb-2",children:u(v)}),s.jsxs("p",{className:"text-teal-400 text-sm",children:[w("location.accuracy","Accuracy"),": ",h(v.accuracy)]}),v.accuracy&&s.jsxs("p",{className:"text-teal-500 text-xs mt-1",children:["Â±",Math.round(v.accuracy),"m"]})]}),s.jsx("p",{className:"text-green-400 font-semibold",children:w("location.redirecting","Redirecting to meditation...")})]}),"fallback"===N&&v&&s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"mb-6",children:s.jsxs("div",{className:"relative inline-block",children:[s.jsx("div",{className:"absolute inset-0 bg-blue-400 rounded-full blur-xl opacity-50"}),s.jsx("div",{className:"relative bg-gradient-to-br from-blue-500 to-cyan-600 p-6 rounded-full",children:s.jsx(i,{className:"w-12 h-12 text-white"})})]})}),s.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:w("location.usingCity","Using Your City Location")}),k&&s.jsx("div",{className:"bg-orange-500/20 backdrop-blur-sm rounded-xl p-4 mb-4 border border-orange-500/30",children:s.jsx("p",{className:"text-orange-200 text-sm",children:"PERMISSION_DENIED"===k.code?w("location.permissionDenied","Location permission was denied"):w("location.unavailable","GPS location unavailable")})}),s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-4 mb-6 border border-white/20",children:[s.jsx("p",{className:"text-teal-200 mb-2",children:u(v)}),s.jsx("p",{className:"text-teal-400 text-sm",children:w("location.approximateLocation","Approximate location from your profile")})]}),s.jsx("button",{onClick:__name(()=>j(v),"onClick"),disabled:_,className:"w-full py-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-xl font-bold text-lg hover:shadow-lg hover:shadow-blue-500/50 transition-all duration-300",children:w("location.continueButton","Continue to Meditation")})]}),"error"===N&&!v&&s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"mb-6",children:s.jsx(n,{className:"w-16 h-16 text-red-400 mx-auto"})}),s.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:w("location.error","Location Error")}),s.jsx("p",{className:"text-red-300 mb-6",children:k?.message||w("location.errorDesc","Could not determine your location")}),s.jsx("button",{onClick:I,className:"w-full py-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-xl font-bold text-lg hover:shadow-lg hover:shadow-blue-500/50 transition-all duration-300",children:w("location.useCityButton","Use My City Instead")})]})]})})},"LocationConsentModal");export{b as LocationConsentModal};
